<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Документация API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <style>
        .method{
            font-size: 20px;
            font-weight: bold;
            margin-right: 10px;
        }
        .post{
            color: orange;
        }
        .get{
            color: green;
        }
        .patch{
            color: purple;
        }
        .delete{
            color: red;
        }
        .description{
            font-weight: 600;
            color: #858585;
        }
        .to_copy{
            text-decoration: underline;
        }
        .json{
            width: 100%;
            background-color: #f4f4f4;
            padding: 15px;
            font-size: 14px;
            border-radius: 15px;
        }
        .json-key {
            color: #d32f2f;
            font-weight: bold;
        }
        .json-string {
            color: #689f38;
        }
        .json-number {
            color: #1976d2;
        }
        .json-boolean {
            color: #ff5722;
        }
        .json-null {
            color: #9e9e9e;
        }
        .json-punctuation {
            color: #212121;
        }
        .json-indent {
            padding-left: 20px;
            display: block;
        }
        .json-array > .json-indent,
        .json-object > .json-indent {
            border-left: 1px dotted #ddd;
            margin-left: 4px;
        }
        .copied{
            color: green;
            font-weight: 800;
        }

    </style>
</head>
<body>
<div class="container-xxl mt-5">
    <h1 class="mb-3">Документация API</h1>
    {% for group in doc %}
        <div class="mb-5">
            <h4 class="mb-2">{{ group.name }}</h4>
            {% if group.values %}
                <div class="mt-4 mb-4">
                    <h5>Расшифровка значений</h5>
                    {% for value in group.values %}
                        <div class="card mb-2">
                            <h6 class="card-header">{{ value.name }} | {{ value.description }}</h6>
                            <div class="card-body">
                                {% for item in value.values %}
                                    {{ item.key }} - {{ item.value }}<br>
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            <div class="accordion">
                {% for endpoint in group.endpoints %}
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#{{ endpoint.codename }}" aria-expanded="false" aria-controls="{{ endpoint.codename }}">
                                {{ endpoint.name }}
                            </button>
                        </h2>
                        <div id="{{ endpoint.codename }}" class="accordion-collapse collapse">
                            <div class="accordion-body">
                                <table class="table mb-5">
                                    <tbody>
                                    <tr>
                                        <th scope="row">Endpoint</th>
                                        <td><span class="method {{ endpoint.method }}">{{ endpoint.method.upper }}</span><span class="to_copy">{{ endpoint.endpoint }}</span></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Описание</th>
                                        <td><span class="description">{{ endpoint.description }}</span></td>
                                    </tr>
                                    </tbody>
                                </table>
                                {% if endpoint.headers %}
                                    <h5>Headers</h5>
                                    <table class="table mb-5">
                                        <tbody>
                                        {% for header in endpoint.headers %}
                                            <tr>
                                                <th scope="row"><span class="to_copy">{{ header.key }}</span></th>
                                                <td><span class="to_copy">{{ header.value }}</span></td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                                {% if endpoint.body %}
                                    <h5>Body</h5>
                                    <table class="table mb-5">
                                        <thead>
                                        <tr>
                                            <th>Ключ</th>
                                            <th>Тип</th>
                                            <th>Описание</th>
                                            <th>Пример</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for body in endpoint.body %}
                                            <tr>
                                                <th scope="row"><span class="to_copy">{{ body.name }}</span></th>
                                                <td>{{ body.type }}</td>
                                                <td><span class="description">{{ body.description }}</span></td>
                                                <td>{{ body.example }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                                {% if endpoint.query_params %}
                                    <h5>Параметры</h5>
                                    <table class="table mb-5">
                                        <thead>
                                        <tr>
                                            <th>Ключ</th>
                                            <th>Тип</th>
                                            <th>Описание</th>
                                            <th>Пример</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for qp in endpoint.query_params %}
                                            <tr>
                                                <th scope="row"><span class="to_copy">{{ qp.name }}</span></th>
                                                <td>{{ qp.type }}</td>
                                                <td><span class="description">{{ qp.description }}</span></td>
                                                <td>{{ qp.example }}</td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                                {% if endpoint.sorting %}
                                    <h5>Сортировка</h5>
                                    <p>Для сортировки передайте в параметрах запроса с ключом "sort" одно или несколько следующих значений</p>
                                    <table class="table mb-5">
                                        <thead>
                                        <tr>
                                            <th>ASC</th>
                                            <th>DESC</th>
                                            <th>Описание</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        {% for sort_param in endpoint.sorting %}
                                            <tr>
                                                <td><span class="to_copy">{{ sort_param.name }}</span></td>
                                                <td><span class="to_copy">-{{ sort_param.name }}</span></td>
                                                <td><span class="description">{{ sort_param.description }}</span></td>
                                            </tr>
                                        {% endfor %}
                                        </tbody>
                                    </table>
                                {% endif %}
                                {% if endpoint.responses %}
                                    {% for response in endpoint.responses %}
                                        <h5>Response ({{ response.name }})</h5>
                                        {% if response.examples %}
                                            <div class="mb-5">
                                                {% for example in response.examples %}
                                                    <div class="json mb-2">
                                                        {{ example }}
                                                    </div>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endfor %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
<script>
    function formatJSON(data, indent = 0) {
        if (data === null) {
            return `<span class="json-null">null</span>`;
        }

        const type = typeof data;

        if (type === 'string') {
            return `<span class="json-string">"${data}"</span>`;
        }

        if (type === 'number') {
            return `<span class="json-number">${data}</span>`;
        }

        if (type === 'boolean') {
            return `<span class="json-boolean">${data}</span>`;
        }

        if (Array.isArray(data)) {
            if (data.length === 0) {
                return `<span class="json-punctuation">[]</span>`;
            }

            let html = `<span class="json-punctuation">[</span>`;
            html += `<div class="json-array json-indent">`;

            data.forEach((item, i) => {
                html += formatJSON(item, indent + 1);
                if (i < data.length - 1) {
                    html += `<span class="json-punctuation">,</span>`;
                }
                html += `<br>`;
            });

            html += `</div><span class="json-punctuation">]</span>`;
            return html;
        }

        if (type === 'object') {
            const keys = Object.keys(data);
            if (keys.length === 0) {
                return `<span class="json-punctuation">{}</span>`;
            }

            let html = `<span class="json-punctuation">{</span>`;
            html += `<div class="json-object json-indent">`;

            keys.forEach((key, i) => {
                html += `<span class="json-key to_copy">"${key}"</span><span class="json-punctuation">: </span>`;
                html += formatJSON(data[key], indent + 1);
                if (i < keys.length - 1) {
                    html += `<span class="json-punctuation">,</span>`;
                }
                html += `<br>`;
            });

            html += `</div><span class="json-punctuation">}</span>`;
            return html;
        }

        return data;
    }

    document.querySelectorAll(".json").forEach(elem => {
        elem.innerHTML = formatJSON(JSON.parse(elem.innerHTML
            .replace(/'/g, '"')
            .replace(/None/g, 'null')
            .replace(/True/g, 'true')
            .replace(/False/g, 'false')))

    })
    document.querySelectorAll(".to_copy").forEach(elem => {
        elem.addEventListener("click", () => {
            navigator.clipboard.writeText(elem.innerHTML.replaceAll('"', ''))
            elem.classList.add("copied")
            setTimeout(() => {elem.classList.remove("copied")}, 700)
        })
    })
</script>
</body>
</html>